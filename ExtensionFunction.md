# 拓展功能

这篇文档将对我实现的 `Mini_Lisp` 解释器中与标准 `Mini_Lisp` 不同的地方以及我添加的地方做出说明。关于 `Mini_Lisp` 标准文档，详见[标准文档](https://pku-software.github.io/mini-lisp-spec/)。

### 与标准 `Mini_Lisp` 不同的内置过程

#### 减法过程

标准 `Mini_Lisp` 要求的是实现至多两个数之间的相减，我实现的这个解释器采用的是可以接受多个参数，如果参数超过2个，那么将会用第一个数依次减去后面所有的数。下面的样例

```lisp
(- 1 2 3)
```

返回的将是 -4。
其他的情况与标准 `Mini_Lisp`的相同。

### 新增的拓展内容

#### 1. REPL多行读入

本 `Mini_Lisp` 解释器支持的REPL多行读入是指，当输入的语句尚未完成时若用户按下回车键，将不会报错，而是允许用户在下一行继续输入后续内容。如果出现括号不匹配，则会报错退出。具体的就是，比如下面这个样例是可以通过解释的：

```lisp
(define x
    2)
```

将会将 `x` 定义为2，并返回空表

但下面这个案例将不能通过解释：

```lisp
(define x
    )) 
```

将会报错 "Unmatched parens"

#### 2. 换行自动缩进

本 `Mini_Lisp` 解释器支持REPL多行读入时，将支持自动缩进，具体的就是缩进到当前对子或列表的左括号的下一个位置。比如

```scheme
>>> (define x (+
...            1
...            2)
...  )
```

#### 3. 文件多行读入

本  `Mini_Lisp` 解释器支持文本的多行读入。也就是说文件的语句不必写在一行，而是可以跨行。与REPL模式相近的，下面的语句可以通过解释：

```lisp
(define x
    2)
```

将会将 `x` 定义为2，并返回空表

但下面这个案例将不能通过解释：

```lisp
(define x
    )) 
```

将会报错 "Unmatched parens"。

#### 4. 从标准输入读取

本 `Mini_Lisp` 解释器支持从标准输入读取，可以通过 `read` 内置过程实现。使用的时候不接受参数，如果标准流已经有值，则直接返回下一个值，否则等待键盘输入。比如这段代码：
```lisp
(define x (read)) ; 等待键入
; 键入 1
x ; 返回1
(+ x (read)) ; 等待键入
; 键入 1 2 3 ，返回 2
(read) ; 返回 2
(* 2 (read)) ; 返回6
```

如果 `read` 接受的参数数目不为零，将会报错

#### 5. 字符串操作

字符串操作是比较常见的一种操作，字符串的比较已经在  `equal?` 和 `eq?` 过程中实现，这里再几个比较常见的字符串操作。

##### 1. 字符串长度：

求字符串长度的内置过程是 `strlen` ，使用的时候需要给出一个字符串类型的变量，比如：

```lisp
(strlen "abc")
```

而接受其他类型的变量或者接受的参数数量低于或超过1个都会报错。

##### 2. 字符串拼接：

进行字符串拼接的内置过程是 `strappend` ，使用的时候需要给出两个字符串类型的变量，比如：

```lisp
(strappend "abc" "def")
```

而接受其他类型的变量或者接受的参数数量低于或超过2个都会报错。

##### 3. 将其他类型的值转换为字符串：

进行转换的内置过程是 `to_string` ，使用的时候只接收一个参数，类型不限，将返回其外部表示的字符串的变量，比如：

```lisp
(to_string 1)
```

将返回 "1"
接受的参数低于或超过1个都会报错。

##### 4. 将字符串转换为数字：

进行转换的内置过程是 `atoi` ，使用的时候接受一个字符串类型的参数，将返回其表示的数字，如果有多个则返回第一个，如果不是数字则返回0。以下的样例：

```lisp
(atoi "123") ; 将返回 123
```

```lisp
(atoi "12.3") ; 将返回12
```

```lisp
(atoi "1 2") ; 将返回1
```

```lisp
(atoi "abc") ; 将返回0
```

接受的参数少于或超过1个或不是字符串类型都会报错。

#### 6. 列表操作

##### 通过索引访问列表元素：

   访问的内置过程是 `at` ，使用的时候接受一个列表和一个数字，将以数字作为索引访问列表元素。以下的样例：

```lisp
   (at '(1 2 3) 1) ; 将返回2
```

   接受的参数少于或超过2个或者第一个参数不是列表或者第二个参数不是整数或者索引超出范围都会报错。
